# Sharp edges for pr-create
#
# NOTE: The `detect` field is informational only - it shows how to manually
# check for the edge case. These are NOT automatically enforced.

edges:
  - id: gh-cli-not-installed
    description: "GitHub CLI (gh) is not installed"
    detect: "gh --version"
    impact: "Cannot create PR. All gh commands will fail."
    fix: |
      Install GitHub CLI:
      brew install gh
    severity: critical

  - id: gh-cli-not-authenticated
    description: "GitHub CLI is not authenticated"
    detect: "gh auth status"
    impact: "Cannot access GitHub API. PR creation will fail with auth error."
    fix: |
      Authenticate with GitHub:
      gh auth login
    severity: critical

  - id: on-main-branch
    description: "Attempting to create PR while on main branch"
    detect: "git branch --show-current"
    impact: "Cannot create PR from main to main. Need a feature branch."
    fix: |
      Create a feature branch first:
      git checkout -b feat/description
      Or if commits exist on main that shouldn't:
      git checkout -b feat/description
      git checkout main
      git reset --hard origin/main
    severity: critical

  - id: uncommitted-changes
    description: "Creating PR with uncommitted changes"
    detect: "git status --porcelain"
    impact: "Uncommitted changes won't be in the PR. May indicate incomplete work."
    fix: |
      Either commit the changes:
      git add <files> && git commit -m "..."
      Or stash them:
      git stash
    severity: high

  - id: no-commits-to-pr
    description: "Branch has no commits ahead of main"
    detect: "git log origin/main..HEAD --oneline | wc -l"
    impact: "Empty PR with no changes. Nothing to review."
    fix: "Make commits first, or verify you're on the correct branch."
    severity: critical

  - id: title-too-long
    description: "PR title exceeds 50 characters"
    detect: "Manual check: count characters in title"
    impact: "Title gets truncated in GitHub UI. Harder to scan."
    fix: |
      Shorten the subject while keeping it specific.
      Move details to the PR body instead.
    severity: medium

  - id: missing-scope
    description: "PR affects specific area but no scope in title"
    detect: "Check if changes are localized to one area"
    impact: "Less clear what area is affected at a glance."
    fix: |
      Add scope in parentheses: type(scope): subject
      Common scopes: workflows, scripts, ci, runner, config
    severity: low

  - id: branch-not-pushed
    description: "Branch exists locally but not on remote"
    detect: "git ls-remote --heads origin $(git branch --show-current)"
    impact: "gh pr create will fail without remote branch."
    fix: |
      Push with upstream tracking:
      git push -u origin HEAD
    severity: high

  - id: vague-subject
    description: "Subject uses vague verbs like 'update', 'improve', 'change'"
    detect: "Manual review of title for vague words"
    impact: "Doesn't communicate what actually changed. Poor commit history."
    fix: |
      Use specific verbs:
      - "Add" for new functionality
      - "Fix" for bug fixes
      - "Remove" for deletions
      - "Refactor" for restructuring
      - "Handle" for edge cases
    severity: medium

  - id: ai-attribution-in-title
    description: "PR title, body, or commits contain ANY AI attribution"
    detect: "Check for Co-Authored-By, AI, Claude, GPT, Copilot, 'Generated by', 'Created with'"
    impact: |
      STRICTLY FORBIDDEN. Complete violation of project conventions.
      PRs and commits must appear as human-authored work.
    fix: |
      Remove ALL AI attribution. This includes:
      - Co-Authored-By: Claude, GPT, or any AI name
      - AI-related emojis
      - "Generated by", "Created with", or similar phrases
      - Any reference to AI tools (Claude, ChatGPT, Copilot, etc.)
      Focus only on describing what changed.
    severity: critical
